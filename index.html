<!DOCTYPE html>
<html lang="en">
<head>
    <title>Network</title>
    <script
            type="text/javascript"
            src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"
    ></script>
    <style type="text/css">
        #mynetwork {
          width: 600px;
          height: 400px;
          border: 1px solid lightgray;
        }
    </style>
</head>
<body>
<div id="buttons">
    <button id="french_button" onclick="toFrench()">French</button>
    <button id="english_button" onclick="toEnglish()">English</button>
</div>
<div id="mynetwork"></div>
<div id="description"></div>
<script type="text/javascript">

    var raw_data = [];
    var nodes = [];
    var edges = [];
    var ids = [];
    var mode = "english";
    var current_description = null;
    var description_container = null;
    var nodes_dataset = null;
    var edges_dataset = null;
    var network = null;
    var data = null;

    fetch('all_nodes.json')
    .then(response => response.json())
    .then(data => {
        const filesList = data.files;
        const fetchPromises = filesList.map(fileName => {
            return fetch(fileName)
            .then(response => response.json())
            .then(fileData => {
                if (!Array.isArray(raw_data)) {
                    raw_data = [];
                }
                if (!Array.isArray(nodes)) {
                    nodes = [];
                }
                if (!Array.isArray(edges)) {
                    edges = [];
                }
                if (!Array.isArray(ids)) {
                    ids = [];
                }
                raw_data.push(fileData);
                nodes.push({id: fileData.id, label: fileData.label.english});
                ids.push(fileData.id);
                for (let edge_data of fileData.edge_to) {
                    edges.push({from: fileData.id, to: edge_data});
                }
            });
        });
        return Promise.all(fetchPromises);
    })
    .then(() => {
        nodes_dataset = new vis.DataSet(nodes);
        edges_dataset = new vis.DataSet(edges);

        var container = document.getElementById("mynetwork");
        data = {
          nodes: nodes_dataset,
          edges: edges_dataset,
        };
        description_container = document.getElementById("description");
        var options = {};
        network = new vis.Network(container, data, options);

        network.on("click", function(clickProperties) {
            if(clickProperties.nodes.length == 1) {
                var id = ids.indexOf(clickProperties.nodes[0]);

                description_container.style.display = "block";
                current_description = raw_data[id].description
                if(mode == "english") {
                    description_container.textContent = current_description.english;
                } else {
                    description_container.textContent = current_description.french;
                }
            } else if(clickProperties.nodes.length == 0) {
                description_container.style.display = 'none';
                current_description = null;
            }
        });
    });

    function toFrench() {
        mode = "french";
        document.getElementById("french_button").textContent = "Fran√ßais";
        document.getElementById("english_button").textContent = "Anglais";
        if(current_description != null) {
            description_container.textContent = current_description.french;
        }

        nodes_dataset.forEach(frenchForEach);

        function frenchForEach(item) {
            var id = ids.indexOf(item.id);
            data.nodes.update({"id":raw_data[id].id, "label":raw_data[id].label.french});
        }
    }

    function toEnglish() {
        mode = "english";
        document.getElementById("french_button").textContent = "French";
        document.getElementById("english_button").textContent = "English";
        if(current_description != null) {
            description_container.textContent = current_description.english;
        }

        nodes_dataset.forEach(englishForEach);

        function englishForEach(item) {
            var id = ids.indexOf(item.id);
            data.nodes.update({"id":raw_data[id].id, "label":raw_data[id].label.english});
        }
    }
</script>
</body>
</html>